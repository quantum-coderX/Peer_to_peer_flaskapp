{% extends "layout.html" %}

{% block title %}Learning Resources - PeerLearn{% endblock %}

{% block content %}
<div class="container mt-5">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h1>Learning Resources</h1>
    <a href="{{ url_for('share_resource') }}" class="btn btn-primary">
      <i class="bi bi-plus-circle"></i> Share Resource
    </a>
  </div>

  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      {% for category, message in messages %}
        <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
          {{ message }}
          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
      {% endfor %}
    {% endif %}
  {% endwith %}

  <!-- Filter Section -->
  <div class="card mb-4">
    <div class="card-body">
      <form method="GET" action="{{ url_for('view_resources') }}" class="row g-3">
        <div class="col-md-6">
          <label for="skill_id" class="form-label">Filter by Skill:</label>
          <select name="skill_id" id="skill_id" class="form-select" onchange="this.form.submit()">
            <option value="">All Skills (My Skills)</option>
            {% for skill in skills %}
              <option value="{{ skill.id }}" {% if selected_skill and selected_skill.id == skill.id %}selected{% endif %}>
                {{ skill.name }}
              </option>
            {% endfor %}
          </select>
        </div>
        <div class="col-md-6 d-flex align-items-end">
          <button type="submit" class="btn btn-secondary me-2">Apply Filter</button>
          <a href="{{ url_for('view_resources') }}" class="btn btn-outline-secondary">Clear Filter</a>
        </div>
      </form>
    </div>
  </div>

  <!-- Resources Display -->
  <div class="row">
    {% if resources %}
      {% for resource in resources %}
        <div class="col-md-6 col-lg-4 mb-4">
          <div class="card h-100 shadow-sm">
            <div class="card-header bg-info text-white">
              <h5 class="card-title mb-0">{{ resource.title }}</h5>
            </div>
            <div class="card-body">
              <p class="card-text">
                <strong>Skill:</strong> 
                <span class="badge bg-primary">{{ resource.skill.name }}</span>
              </p>
              
              {% if resource.description %}
                <p class="card-text">{{ resource.description }}</p>
              {% else %}
                <p class="card-text text-muted">No description provided.</p>
              {% endif %}
              
              <div class="mt-3">
                <p class="text-muted mb-2">
                  <small>
                    <i class="bi bi-person"></i> Shared by: <strong>{{ resource.user.username }}</strong>
                  </small>
                </p>
                <p class="text-muted mb-0">
                  <small>
                    <i class="bi bi-calendar"></i> {{ resource.created_at.strftime('%B %d, %Y') }}
                  </small>
                </p>
              </div>
            </div>
            <div class="card-footer bg-transparent">
              {% if resource.url %}
                <a href="{{ resource.url }}" target="_blank" class="btn btn-primary btn-sm w-100">
                  <i class="bi bi-link-45deg"></i> View Resource
                </a>
              {% elif resource.file_path %}
                <a href="{{ url_for('download_resource', resource_id=resource.id) }}" class="btn btn-primary btn-sm w-100">
                  <i class="bi bi-download"></i> Download Resource
                </a>
              {% else %}
                <button class="btn btn-secondary btn-sm w-100" disabled>
                  No link available
                </button>
              {% endif %}
            </div>
          </div>
        </div>
      {% endfor %}
    {% else %}
      <div class="col-12">
        <div class="alert alert-info text-center">
          <h4>No Resources Found</h4>
          <p>
            {% if selected_skill %}
              No resources have been shared for <strong>{{ selected_skill.name }}</strong> yet.
            {% else %}
              No resources available for your skills. 
              <a href="{{ url_for('add_user_skill') }}">Add skills</a> to see relevant resources, 
              or <a href="{{ url_for('share_resource') }}">share a resource</a> to help others!
            {% endif %}
          </p>
        </div>
      </div>
    {% endif %}
  </div>

  <!-- Quick Stats -->
  <div class="card mt-4 bg-light">
    <div class="card-body">
      <div class="row text-center">
        <div class="col-md-4">
          <h3 class="text-primary">{{ resources|length }}</h3>
          <p class="text-muted mb-0">Resources Available</p>
        </div>
        <div class="col-md-4">
          <h3 class="text-success">{{ skills|length }}</h3>
          <p class="text-muted mb-0">Skills Covered</p>
        </div>
        <div class="col-md-4">
          <h3 class="text-info">{{ current_user.shared_resources|length }}</h3>
          <p class="text-muted mb-0">Resources You've Shared</p>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
